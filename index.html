<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Service Worker and Frontend Performance</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">
		<link rel="stylesheet" href="css/custom/sssw.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Service<br> Worker<br> &<br> Frontend<br> Performance</h1>
				</section>
				<section>
					<h2>Warning: Morten reminded me about this on Monday</h2>
					<p class="fragment"><small>(the slides might be a bit rough on the edges)</small></p>
				</section>
				<section>
					<h2>And I've been busy not<br> working since October</h2>
				</section>
				<section>
					<section>
						<h2>I've been traveling.</h2>
						<h2 class="fragment">Yes, the whole time.</h2>
						<h1 class="fragment"><br><span class="emoji">üåè</span> Southeast Asia <span class="emoji">üåè</span></h1>
						<p class="fragment">It was hard work.</p>
					</section>
					<section data-background="img/vietnam-halong-bay.jpg"></section>
					<section data-background="img/vietnam-catba.jpg"></section>
					<section data-background="img/myanmar-kalaw.jpg"></section>
					<section data-background="img/laos-muang-khua.jpg"></section>
					<section data-background="img/laos-muang-ngoy.jpg"></section>
					<section data-background="img/thailand-koh-lipe.jpg"></section>
					<section>
						<h2>Anyway, the point.</h2>
					</section>
				</section>
				<section>
					<h2>The internet is super flaky in all of these places.</h2>
				</section>
				<section>
					<h3>Worse than conference wi-fi</h3>
					<p class="fragment"><small>(I'm sure the wifi at this event is superb!)</small></p>
				</section>
				<section>
					<section>
						<h3>Traveler's Dilemma</h3>
						<p>Constantly looking up information,<br> can't pull it up in the right moment.</p>
					</section>
					<section>
						<p>If only those fonts weren't blocking render...</p>
					</section>
				</section>
				<section>
					<h2>How can we make the internet tolerable in places with shoddy network access?</h2>
					<p class="fragment only-visible-active">You know the answer already:</p>
					<ul>
						<li class="fragment">Use responsive images to reduce page weight</li>
						<li class="fragment">Don't block rendering with CSS/JS/fonts</li>
						<li class="fragment">Provide critical CSS so the browser paints <abbr title="as soon as possible">ASAP</abbr></li>
						<li class="fragment">Set and stick to a performance budget</li>
						<li class="fragment">Test your work using robots</li>
						<li class="fragment">Use HTTP/2 to push/stream assets.</li>
					</ul>
				</section>
				<section>
					<h2>Extra credit...</h2>
					<p class="fragment"><a href="https://fourkitchens.com/blog/article/throttled-thursdays">Schedule some weekly empathy for less fortunate folks</a></p>
				</section>
				<section>
					<h1>but wait!</h1>
					<p class="fragment">Isn't all of that stuff focusing on <strong>first page load</strong>,<br> potentially to the detriment of the subsequent loads?</p>
				</section>
				<section>
					<p>Yes. But it can all be fixed with</p>
					<h1 class="fragment">Service Worker</h1>
				</section>
				<section>
					<section>
						<p>Service Worker is a <a href="http://www.html5rocks.com/en/tutorials/workers/basics/">Web Worker</a> which can intercept and allow you to handle network requests for your website.</p>
					</section>
					<section>
						<p>Web Workers are plain JavaScript, but they're not part of the main thread that powers normal browser interactivity.</p>
					</section>
					<section>
						<p>That means no access to the DOM, but other stuff that we normally avoid in JS is ok (e.g. long-running computations).</p>
					</section>
					<section>
						<p class="fragment shrink">Service Worker has additional super powers:</p>
						<ul>
							<li class="fragment">Enable custom handling of HTTP requests</li>
							<li class="fragment">Enable you to send push notifications</li>
							<li class="fragment">Enable background updates</li>
							<li class="fragment">Qualify your site for other web platform features</li>
						</ul>
					</section>
					<section>
						<p>It is the first, very important step towards</p>
						<h2>Progressive Web Apps</h2>
					</section>
				</section>
				<section>
					<section>
						<p>Service Worker forms the shell of your progressive web app.</p>
						<p class="fragment">After successful install <em>you can always show something instantly</em>, even while other content is loading.</p>
					</section>
					<section>
						<p>Service Worker installation only takes a few seconds.</p>
						<p class="fragment">It starts working on the second page load.</p>
					</section>
				</section>
				<section>
					<p>Now compare that to native:</p>
					<div class="fragment">
						<blockquote><p>...the first load of a native app sucks. It‚Äôs gated by an app store and a huge download, but once you get to a point where the app is installed, that up-front cost is amortized across all app starts and none of those starts have a variable delay...</p></blockquote>
						<cite><a href="https://infrequently.org/2016/05/service-workers-and-pwas-its-about-reliable-performance-not-offline/">Alex Russel</a>, Google Chrome</cite>
					</div>
				</section>
				<section>
					<p>People tolerate app installations because afterwards,<br> they can rely on native apps to <strong>load instantly</strong>.</p>
					<br>
					<p class="fragment">Today, they cannot expect that for web apps. <span class="fragment">üò¶</span></p>
				</section>
				<section>
					<p class="fragment grow"><em><strong>Service Workers provide <u>reliable performance</u></strong></em>.</p>
					<p class="fragment main-point-of-talk">important takeaway ‚òù</p>
				</section>
				<section>
					<p>Reliable performance is gold.</p>
					<p class="fragment">Performance boils down to perception.</p>
					<p class="fragment">When we meet expectations, we make people happy.</p>
					<p class="fragment"><small style="transform: translateY(-20px); opacity: .666; ">(or at least not annoyed)</small></p>
				</section>
				<section>
					<p>Assuming your initial page load is decent, adding a<br> Service Worker puts you <em>ahead of native apps</em>.</p>
					<p class="fragment">Seamless install + instant boot on revisits.</p>
				</section>
				<section>
					<h2>Demo time</h2>
					<p class="fragment"><a href="https://chrisruppel.com">Service Worker on chrisruppel.com</a></p>
				</section>
				<section>
					<section>
						<h2>Getting started</h2>
						<br>
						<ol>
							<li class="fragment highlight">Enable SSL on your website</li>
							<li class="fragment highlight">Decide what parts of your site are <abbr title="minimum viable product">MVP</abbr></li>
							<li class="fragment highlight">Decide on a caching strategy</li>
						</ol>
					</section>
					<section>
						<h3>1. Enable SSL</h3>
						<p>Service Worker exposes new, powerful ablities,<br> particularly in regards to network activity.</p>
						<br>
						<p class="fragment">It can be easily abused via <abbr title="man in the middle">MITM</abbr> attacks.</p>
						<br>
						<p class="fragment">The spec requires the origin to be HTTPS.<br> It does nothing on unencrypted sites.</p>
						<p class="fragment"><small><span class="emoji">‚ö°</span> <code>localhost</code> is exempt to allow for development <span class="emoji">‚ö°</span></small></p>
					</section>
					<section>
						<h3>2. What to cache?</h3>
						<p>You can't cache your whole site.<br> Pick the most important static pages.</p>
						<br>
						<p class="fragment">Caching too much will mean <em>your</em> cache is axed<br> when the browser needs to free up memory.</p>
						<br>
						<p class="fragment">It's easy to display an "offline" message<br> which directs users to your cached pages.</p>
					</section>
					<section>
						<h3>3. How to cache?</h3>
						<br>
						<p>Need some help? Jake Archibald, co-author of<br> the Service Worker spec, has you covered:</p>
						<br>
						<p class="fragment"><a href="https://jakearchibald.com/2014/offline-cookbook/">Offline Cookbook</a>, a reference of caching use-cases<br> along with code snippets for your Service Worker.</p>
					</section>
					<section>
						<h3>Common strategy</h3>
						<br>
						<p>Start by implementing <em>Stale While Revalidate:</em></p>
						<br>
						<ol>
							<li class="fragment highlight">Cached assets are used immediately.</li>
							<li class="fragment highlight">Cache entry is updated in the background.</li>
							<li class="fragment highlight">Next page load uses new asset.</li>
						</ol>
						<br><br>
						<p class="fragment">Result: fast requests while maintaining a warm cache.</p>
					</section>
				</section>
				<section>
					<h3>Advanced Strategies</h3>
					<br>
					<p>Watch Jake explain the process of booting an app using the Service Worker and streaming content to the page.</p>
					<p class="fragment"><a href="https://www.youtube.com/watch?v=d5_6yHixpsQ#t=420">View on YouTube</a></p>
				</section>
				<section data-background="#0678be" data-state="drupal">
					<section>
						<h3>Streaming, you say?</h3>
						<h3 class="fragment">Drupal 8.1 has you covered</h3>
						<br>
						<p class="fragment"><a href="https://drupal.org/project/big_pipe">BigPipe module</a>, now in Drupal 8.1 core!</p>
					</section>
					<section>
						<p>BigPipe sends the cached parts of the page when ready,<br> then fills in the slower pieces as they are built on the server.</p>
					</section>
					<section>
						<h3>Demo video of BigPipe</h3>
						<iframe width="560" height="315" src="https://www.youtube.com/embed/JwzX0Qv6u3A" frameborder="0" allowfullscreen=""></iframe>
					</section>
				</section>
				<section>
					<section>
						<h2>Back to the original problem.</h2>
					</section>
					<section data-background="img/indonesia-ijen.jpg"></section>
					<section data-background="img/indonesia-borobudur.jpg"></section>
					<section data-background="img/indonesia-bali.jpg"></section>
					<section data-background="img/malaysia-langkawi.jpg"></section>
					<section data-background="img/thailand-kohyanoi.jpg"></section>
					<section>
						<h2>Bad Connectivity</h2>
						<p class="fragment">Travelers often need info fast. Waiting for wi-fi<br> is not an option when the bus is leaving.</p>
						<br>
						<p class="fragment">Would have been great to save pages offline...</p>
						<p class="fragment">...which we could have pulled up instantly later on.</p>
					</section>
				</section>
				<section>
					[TODO: Talk about caching content.]
				</section>
				<section>
					<h1>Thank you!</h1>
				</section>
				<section>
					<br><br>
					<h1>Questions?</h1>
					<br><br>
					<p>
						<a href="https://twitter.com/rupl">@rupl</a> ‚Äî
						<a href="https://chrisruppel.com">chrisruppel.com</a>
					</p>
					<p><small>All photos were taken by me. <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/us/">CC BY-SA-NC 3.0</a></small></p>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
